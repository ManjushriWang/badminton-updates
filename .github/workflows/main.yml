# .github/workflows/main.yml
name: Auto Run Badminton Schedule

on:
  schedule:
    - cron: '*/5 * * * *'     # æ¯å‘¨æ—¥ NZT 16:10 = UTC 04:10ï¼ˆæµ‹è¯•æ”¹æˆ* /5 * * * *åæ¢å¤æ­¤è¡Œ10 4 * * 0 ï¼‰
  workflow_dispatch:        # ä¿ç•™æ‰‹åŠ¨è§¦å‘æŒ‰é’®

jobs:
  run-script:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Install dependencies
        run: |
          pip install requests beautifulsoup4 lxml

      - name: Run schedule script
        run: |
          python generate_schedule.py

      - name: Commit schedule.md
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add schedule.md
          git commit --allow-empty -m 'Auto update schedule.md'
          git push

      - name: Deploy to WordPress
        env:
          WP_URL:          ${{ secrets.WP_URL }}
          WP_USER:         ${{ secrets.WP_USER }}
          WP_APP_PASSWORD: ${{ secrets.WP_APP_PASSWORD }}
        run: |
          # æŠŠ schedule.md è½¬æˆ JSON å¯ç”¨çš„å•è¡Œï¼Œè½¬ä¹‰æ¢è¡Œå’ŒåŒå¼•å·
          CONTENT=$(sed ':a;N;$!ba;s/\n/\\n/g; s/"/\\"/g' schedule.md)
          # åœ¨ WordPress åˆ›å»ºæ–°æ–‡ç« 
          curl -X POST "$WP_URL/wp-json/wp/v2/posts" \
               -u "$WP_USER:$WP_APP_PASSWORD" \
               -H "Content-Type: application/json" \
               -d "{
                 \"title\": \"ğŸ¾ Weekly Badminton Schedule\",
                 \"content\": \"$CONTENT\",
                 \"status\": \"publish\"
               }"
